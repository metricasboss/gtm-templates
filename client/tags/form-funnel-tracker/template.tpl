___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "form_funnel_tracker",
  "version": 1,
  "securityGroups": [],
  "displayName": "Form Funnel Tracker | Rastreamento de Formulários",
  "description": "Track form field-by-field interactions, pushing structured events to dataLayer for analytics / Rastreie interações campo a campo em formulários, enviando eventos estruturados para o dataLayer",
  "categories": ["ANALYTICS", "CONVERSIONS", "TAG_MANAGEMENT"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Métricas Boss",
    "thumbnail": "data:image/jpeg;base64,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\u003d"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "configGroup",
    "displayName": "Configuration | Configuração",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "formSelector",
        "displayName": "Form CSS Selector | Seletor CSS dos Formulários",
        "simpleValueType": true,
        "defaultValue": "form",
        "help": "CSS selector to target forms (e.g., 'form', '.checkout-form', '#contact-form') / Seletor CSS para identificar formulários"
      },
      {
        "type": "CHECKBOX",
        "name": "trackFieldTypes",
        "checkboxText": "Track all field types | Rastrear todos os tipos de campo",
        "simpleValueType": true,
        "defaultValue": true,
        "help": "Track all input types including text, email, tel, select, textarea, etc. / Rastrear todos os tipos de input"
      },
      {
        "type": "TEXT",
        "name": "eventPrefix",
        "displayName": "Event Name Prefix | Prefixo do Nome do Evento",
        "simpleValueType": true,
        "defaultValue": "form_funnel",
        "help": "Prefix for dataLayer events (e.g., 'form_funnel' creates 'form_funnel_focus') / Prefixo para eventos no dataLayer"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "trackingOptions",
    "displayName": "Tracking Options | Opções de Rastreamento",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "trackFocus",
        "checkboxText": "Track focus events | Rastrear quando campo recebe foco",
        "simpleValueType": true,
        "defaultValue": true
      },
      {
        "type": "CHECKBOX",
        "name": "trackBlur",
        "checkboxText": "Track blur events | Rastrear quando campo perde foco",
        "simpleValueType": true,
        "defaultValue": true
      },
      {
        "type": "CHECKBOX",
        "name": "trackChange",
        "checkboxText": "Track change events | Rastrear alterações em campos",
        "simpleValueType": true,
        "defaultValue": true
      },
      {
        "type": "CHECKBOX",
        "name": "trackProgress",
        "checkboxText": "Track form progress | Rastrear progresso do preenchimento",
        "simpleValueType": true,
        "defaultValue": true,
        "help": "Calculate and send percentage of fields filled / Calcular e enviar porcentagem de campos preenchidos"
      },
      {
        "type": "CHECKBOX",
        "name": "trackSubmit",
        "checkboxText": "Track form submission | Rastrear envio do formulário",
        "simpleValueType": true,
        "defaultValue": true
      },
      {
        "type": "CHECKBOX",
        "name": "trackAutocomplete",
        "checkboxText": "Detect autocomplete | Detectar preenchimento automático",
        "simpleValueType": true,
        "defaultValue": true,
        "help": "Detect when fields are filled by browser autocomplete / Detectar quando campos são preenchidos automaticamente"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "securityDebug",
    "displayName": "Security & Debug | Segurança e Debug",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "excludeFields",
        "displayName": "Excluded Fields | Campos Excluídos",
        "simpleValueType": true,
        "defaultValue": "password,credit_card,cvv,ssn",
        "help": "Comma-separated field names to exclude from tracking / Nomes de campos separados por vírgula para excluir do rastreamento"
      },
      {
        "type": "CHECKBOX",
        "name": "deduplicateEvents",
        "checkboxText": "Prevent duplicate events | Prevenir eventos duplicados",
        "simpleValueType": true,
        "defaultValue": true,
        "help": "Prevent same event from firing twice within 500ms / Prevenir que mesmo evento dispare duas vezes em 500ms"
      },
      {
        "type": "SELECT",
        "name": "observerMode",
        "displayName": "Dynamic Form Detection | Detecção de Formulários Dinâmicos",
        "macrosInSelect": false,
        "selectItems": [
          { "value": "none", "displayValue": "Disabled | Desabilitado" },
          { "value": "mutation", "displayValue": "Enabled (MutationObserver) | Habilitado" }
        ],
        "simpleValueType": true,
        "defaultValue": "mutation",
        "help": "Watch for forms added to the page after load / Observar formulários adicionados após carregamento da página"
      },
      {
        "type": "CHECKBOX",
        "name": "enableDebug",
        "checkboxText": "Enable console logging | Habilitar logs no console",
        "simpleValueType": true,
        "defaultValue": false
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const log = require('logToConsole');
const JSON = require('JSON');
const encodeUriComponent = require('encodeUriComponent');

// Build configuration object from template parameters
const config = {
  formSelector: data.formSelector || 'form',
  trackFieldTypes: data.trackFieldTypes !== false,
  eventPrefix: data.eventPrefix || 'form_funnel',
  trackFocus: data.trackFocus !== false,
  trackBlur: data.trackBlur !== false,
  trackChange: data.trackChange !== false,
  trackProgress: data.trackProgress !== false,
  trackSubmit: data.trackSubmit !== false,
  trackAutocomplete: data.trackAutocomplete !== false,
  excludeFields: data.excludeFields || 'password,credit_card,cvv,ssn',
  deduplicateEvents: data.deduplicateEvents !== false,
  observerMode: data.observerMode || 'mutation',
  enableDebug: data.enableDebug || false
};

if (config.enableDebug) {
  log('Form Funnel Tracker - Configuration:', config);
}

// Generate tracking script
const trackingScript = `
(function() {
  'use strict';

  var config = ` + JSON.stringify(config) + `;
  var trackedForms = new WeakSet();
  var eventCache = {};
  var formIndexCounter = 0;

  function debugLog(message, data) {
    if (config.enableDebug) {
      console.log('[Form Funnel Tracker] ' + message, data || '');
    }
  }

  // Push event to dataLayer
  function pushEvent(eventData) {
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push(eventData);
    debugLog('Event pushed:', eventData);
  }

  // Check if field should be tracked
  function shouldTrackField(field) {
    if (!field || !field.name) return false;

    var excludedFields = config.excludeFields.toLowerCase().split(',').map(function(f) {
      return f.trim();
    });

    var fieldName = (field.name || '').toLowerCase();
    var fieldType = (field.type || '').toLowerCase();

    // Check if field name or type is in exclusion list
    for (var i = 0; i < excludedFields.length; i++) {
      if (fieldName.indexOf(excludedFields[i]) !== -1 || fieldType.indexOf(excludedFields[i]) !== -1) {
        debugLog('Field excluded:', field.name);
        return false;
      }
    }

    return true;
  }

  // Check for duplicate events
  function isDuplicateEvent(formId, fieldId, action) {
    if (!config.deduplicateEvents) return false;

    var cacheKey = formId + '_' + fieldId + '_' + action;
    var now = Date.now();

    if (eventCache[cacheKey] && (now - eventCache[cacheKey]) < 500) {
      debugLog('Duplicate event prevented:', cacheKey);
      return true;
    }

    eventCache[cacheKey] = now;
    return false;
  }

  // Calculate form progress
  function calculateProgress(form) {
    if (!form) return 0;

    var totalFields = 0;
    var filledFields = 0;

    var elements = form.elements;
    for (var i = 0; i < elements.length; i++) {
      var field = elements[i];

      if (field.type === 'submit' || field.type === 'button' || field.type === 'reset') {
        continue;
      }

      if (!shouldTrackField(field)) {
        continue;
      }

      totalFields++;

      if (field.type === 'checkbox' || field.type === 'radio') {
        if (field.checked) filledFields++;
      } else if (field.value && field.value.trim().length > 0) {
        filledFields++;
      }
    }

    if (totalFields === 0) return 0;
    return Math.round((filledFields / totalFields) * 100);
  }

  // Get form identifier
  function getFormIdentifier(form) {
    if (!form) return 'unknown_form';

    if (form.id) return form.id;
    if (form.name) return form.name;
    if (form.className) return form.className.split(' ')[0];

    if (!form._formIndex) {
      form._formIndex = formIndexCounter++;
    }
    return 'form_' + form._formIndex;
  }

  // Get field identifier
  function getFieldIdentifier(field) {
    if (!field) return 'unknown_field';

    if (field.name) return field.name;
    if (field.id) return field.id;

    return field.type + '_' + Array.prototype.indexOf.call(field.form.elements, field);
  }

  // Get field label
  function getFieldLabel(field) {
    if (!field) return '';

    if (field.labels && field.labels.length > 0) {
      return field.labels[0].innerText || field.labels[0].textContent || '';
    }

    var label = field.getAttribute('aria-label') || field.getAttribute('placeholder') || '';
    return label;
  }

  // Track field event
  function trackField(field, action) {
    if (!field || !field.form) return;

    var formId = getFormIdentifier(field.form);
    var fieldId = getFieldIdentifier(field);

    if (isDuplicateEvent(formId, fieldId, action)) {
      return;
    }

    var eventData = {
      event: config.eventPrefix + '_' + action,
      form_id: formId,
      field_id: fieldId,
      field_type: field.type || 'text',
      field_name: field.name || '',
      field_label: getFieldLabel(field),
      field_value_length: (field.value || '').length,
      timestamp: Date.now()
    };

    if (config.trackProgress && action !== 'submit') {
      eventData.form_progress = calculateProgress(field.form);
    }

    pushEvent(eventData);
  }

  // Track form submit
  function trackFormSubmit(form) {
    if (!form) return;

    var formId = getFormIdentifier(form);

    if (isDuplicateEvent(formId, 'form', 'submit')) {
      return;
    }

    var eventData = {
      event: config.eventPrefix + '_submit',
      form_id: formId,
      form_progress: calculateProgress(form),
      timestamp: Date.now()
    };

    pushEvent(eventData);
  }

  // Detect autocomplete
  var autocompleteTimers = {};
  function detectAutocomplete(field) {
    if (!config.trackAutocomplete || !field) return;

    var fieldId = getFieldIdentifier(field);

    if (autocompleteTimers[fieldId]) {
      clearTimeout(autocompleteTimers[fieldId]);
    }

    autocompleteTimers[fieldId] = setTimeout(function() {
      if (field.value && field.value.length > 0 && document.activeElement !== field) {
        trackField(field, 'autocomplete');
      }
    }, 100);
  }

  // Attach listeners to form
  function attachFormListeners(form) {
    if (!form || trackedForms.has(form)) return;

    trackedForms.add(form);
    debugLog('Tracking form:', getFormIdentifier(form));

    var elements = form.elements;
    for (var i = 0; i < elements.length; i++) {
      var field = elements[i];

      if (field.type === 'submit' || field.type === 'button' || field.type === 'reset') {
        continue;
      }

      if (!shouldTrackField(field)) {
        continue;
      }

      if (config.trackFocus) {
        field.addEventListener('focus', function(e) {
          trackField(e.target, 'focus');
        });
      }

      if (config.trackBlur) {
        field.addEventListener('blur', function(e) {
          trackField(e.target, 'blur');
        });
      }

      if (config.trackChange) {
        field.addEventListener('change', function(e) {
          trackField(e.target, 'change');
        });
      }

      if (config.trackAutocomplete) {
        field.addEventListener('input', function(e) {
          detectAutocomplete(e.target);
        });
      }
    }

    if (config.trackSubmit) {
      form.addEventListener('submit', function(e) {
        trackFormSubmit(e.target);
      });
    }
  }

  // Initialize tracking
  function initTracking() {
    debugLog('Initializing form tracking...');

    try {
      var forms = document.querySelectorAll(config.formSelector);
      debugLog('Found ' + forms.length + ' forms');

      for (var i = 0; i < forms.length; i++) {
        attachFormListeners(forms[i]);
      }
    } catch (e) {
      debugLog('Error finding forms, falling back to "form" selector:', e);
      var fallbackForms = document.querySelectorAll('form');
      for (var j = 0; j < fallbackForms.length; j++) {
        attachFormListeners(fallbackForms[j]);
      }
    }

    // Setup MutationObserver for dynamic forms
    if (config.observerMode === 'mutation' && window.MutationObserver) {
      debugLog('Setting up MutationObserver for dynamic forms');

      var observer = new MutationObserver(function(mutations) {
        for (var i = 0; i < mutations.length; i++) {
          var mutation = mutations[i];

          for (var j = 0; j < mutation.addedNodes.length; j++) {
            var node = mutation.addedNodes[j];

            if (node.nodeType !== 1) continue;

            if (node.tagName === 'FORM') {
              attachFormListeners(node);
            } else if (node.querySelectorAll) {
              var nestedForms = node.querySelectorAll(config.formSelector);
              for (var k = 0; k < nestedForms.length; k++) {
                attachFormListeners(nestedForms[k]);
              }
            }
          }
        }
      });

      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    }
  }

  // Start tracking when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTracking);
  } else {
    initTracking();
  }
})();
`;

// Inject script via data URI
const dataUri = 'data:text/javascript;charset=utf-8,' + encodeUriComponent(trackingScript);

injectScript(dataUri, data.gtmOnSuccess, data.gtmOnFailure, 'formFunnelTracker');


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "data:*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 28/1/2026, 22:00:00

This template tracks form field-by-field interactions, pushing structured events to the dataLayer for analytics purposes.

Events pushed to dataLayer:
- form_funnel_focus: When a field receives focus
- form_funnel_blur: When a field loses focus
- form_funnel_change: When a field value changes
- form_funnel_submit: When form is submitted
- form_funnel_autocomplete: When autocomplete is detected

Each event includes:
- form_id: Identifier of the form
- field_id: Identifier of the field
- field_type: Type of field (text, email, etc.)
- field_name: Name attribute of the field
- field_label: Label text associated with the field
- field_value_length: Length of field value (NOT the value itself for security)
- form_progress: Percentage of form completion (0-100)
- timestamp: Unix timestamp of the event

Security features:
- Never captures field values, only value length
- Excludes sensitive fields by default (password, credit_card, cvv, ssn)
- LGPD compliant - no PII captured

Performance features:
- Duplicate event prevention (500ms window)
- MutationObserver for dynamic forms
- Efficient event caching

For more information, see the README.md file in the template folder.
